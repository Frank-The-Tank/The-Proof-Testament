<div class="row backgroundContainer">

  <div class="col-md-7 componentContainer">
    <app-editor></app-editor>
    <div #editorContainer id="textBox"></div>
    <button (click)="addEditor()" class="addEditorBtn" type="button">Add Editor</button>
    <button (click)="export()" class="export" type="button">Export</button>

    <div id="raw_latex" style="display: none"></div>

    <div id="tabs">
      <div class="tab" id="tab_input">
        <button id="compile" autofocus>Compile this LaTeX code to a PDF</button>
      </div>

      <div class="tab" id="tab_output">
        <h3>Console Output</h3>

        <pre id="output" style="overflow: scroll; max-height: 300px">
        Click "Compile this LaTeX code to PDF" at the top of this page and watch the console output here.
        </pre>

        <a name="running" id="running" style="display: none">
          Compilingâ€¦
          <img src="loading.gif" />
        </a>
      </div>

      <div class="tab" id="tab_open_pdf" style="display: none">
        <h3>View your PDF</h3>

        <button id="open_pdf_btn">Open your PDF</button>
        <a name="open_pdf"></a>
      </div>

    </div>

    <script type="text/javascript">
      var visibilityChanger = function(element_id) {
        return function(visible) {
          document.getElementById(element_id).style.display = visible ? 'block' : 'none';
        }
      }

      var showLoadingIndicator = visibilityChanger("running")
      var showOpenButton = visibilityChanger("tab_open_pdf")

      var appendOutput = function(msg) {
        var output = document.getElementById("output");

        var content = output.textContent;

        output.textContent = content + "\r\n" + msg;

        output.scrollTop = 999999;
        console.log(msg);
      }

      var pdf_dataurl = undefined;
      var compile = function(source_code) {
        document.getElementById("output").textContent = "";
        showLoadingIndicator(true);

        var pdftex = new PDFTeX();
        pdftex.set_TOTAL_MEMORY(80*1024*1024).then(function() {
          pdftex.on_stdout = appendOutput;
          pdftex.on_stderr = appendOutput;

          console.time("Execution time");

          pdftex.compile(source_code).then(function(pdf_dataurl) {
            console.timeEnd("Execution time");

            showLoadingIndicator(false);

            if (pdf_dataurl === false)
              return;

            showOpenButton(true);
            window.location.href = "#open_pdf";
            document.getElementById("open_pdf_btn").focus();
          });
        });
      }
      console.log("hi");
      
      document.getElementById("compile").addEventListener("click", function(e) {
        var source_code = document.getElementById("raw_latex").innerHTML;
        console.log(source_code);
        // compile(source_code);
      });

      document.getElementById("open_pdf_btn").addEventListener("click", function(e) {
        window.open(pdf_dataurl);
        e.preventDefault();
      });

      var pdftex_preload = new PDFTeX("pdftex-worker.js");
      pdftex_preload = undefined;
    </script>
  </div>

  <div class="col-md-5 componentContainer">
    <app-bible></app-bible>
  </div>

  <div id="footerBox">
    <app-footer></app-footer>
  </div>

</div>
